<%= content_tag(:table, id: 'character-table', class: %w( table table-condensed )) do
  content_tag(:tr) do
    safe_join [
      content_tag(:th, nil),
      content_tag(:th, 'Name'),
      content_tag(:th, 'S', { title: 'Strength' }),
      content_tag(:th, 'D', { title: 'Dexterity' }),
      content_tag(:th, 'C', { title: 'Constitution' }),
      content_tag(:th, 'I', { title: 'Intelligence' }),
      content_tag(:th, 'W', { title: 'Wisdom' }),
      content_tag(:th, 'C', { title: 'Charisma' }),
      content_tag(:th, 'Per', { title: 'Perception' }),
      content_tag(:th, 'Init', { title: 'Initiative' }),
      content_tag(:th, 'Spd', { title: 'Speed' }),
      content_tag(:th, 'AC', { title: 'Armor Class' }),
    ]
  end <<
  safe_join( @chars.map do |c|
    second_row = c.notes && c.notes != ""
    tr_klass = c.highlight ? [ 'info' ] : []
    td_attrs = second_row ? { rowspan: 2 } : {}
    s = content_tag(:tr, class: tr_klass, 'data-char-id' => c.id, 'data-char-highlight' => c.highlight) do
      cells = [ content_tag(:td, content_tag(:span, nil, class: %w( glyphicon glyphicon-pencil )), td_attrs) ]
      cells << content_tag(:td, c.name, td_attrs)
      [ :str, :dex, :con, :int, :wis, :chr, :perception, :initiative, :speed, :ac ].each do |k|
        cells << content_tag(:td, c.send(k))
      end
      safe_join(cells, '')
    end
    if c.notes && c.notes != ""
      s += content_tag(:tr, class: tr_klass, 'data-notes-id' => c.id) do
        content_tag(:td, c.notes, { colspan:30 })
      end
    end
    s
  end, '')
end %>
