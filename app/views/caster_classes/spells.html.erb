<%= tag.div(class: %w(modal-dialog)) do %>
  <%= form_with(method: :post, action: caster_class_spells_path,
                id: 'spells-form', class: 'form', role: 'form') do %>
    <%= tag.div(class: %w(modal-content)) do %>
      <%= tag.div(class: %w(modal-header)) do %>
        <%= tag.h5(@cclass.name, id: 'spells-modal-label', class: %w(modal-title)) %>
        <%= tag.button(type: 'button', class: %w(btn-close), 'data-bs-dismiss': 'modal',
                       aria: { label: 'close' }) %>
      <% end %>

      <%= tag.div(class: %w(modal-body)) do %>
        <% @spells.chunk(&:level).each do |level, subspells| %>
          <%= tag.h5(class:%w(mt-2)) { level == 0 ? 'Cantrips' : "Level #{level}"} %>
          <% lidx = 0 ; ridx = (subspells.count + 1) / 2 %>
          <% while lidx <= (subspells.count / 2) do %>
            <%= tag.div(class: %w(row)) do %>
              <% if (subspell = subspells[lidx]) %>
                <%= tag.div(class: %w(col-6)) do %>
                  <%= tag.div(class: %w(form-check)) do %>
                    <%= tag.input(id: "spell-#{subspell.id}", class: %w(form-check-input), type: 'checkbox', name: "spell_ids[#{subspell.id}]", checked: @cclass.spell_ids.include?(subspell.id)) %>
                    <%= tag.label(subspell.name, class: %w(form-check-label), for: "spell-#{subspell.id}") %>
                  <% end %>
                <% end %>
              <% end %>
              <% if (subspell = subspells[ridx]) %>
                <%= tag.div(class: %w(col-6)) do %>
                  <%= tag.div(class: %w(form-check)) do %>
                    <%= tag.input(id: "spell-#{subspell.id}", class: %w(form-check-input), type: 'checkbox', name: "spell_ids[#{subspell.id}]", checked: @cclass.spell_ids.include?(subspell.id)) %>
                    <%= tag.label(subspell.name, class: %w(form-check-label), for: "spell-#{subspell.id}") %>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>
            <% lidx += 1; ridx += 1 %>
          <% end %>
        <% end %>
      <% end %>

      <%= tag.div(class: %w(modal-footer)) do %>
        <%= tag.button('Cancel', type: 'button', class: %w(btn btn-outline-secondary),
          'data-bs-dismiss': 'modal') %>
        <%= tag.button('Submit', type: 'button', id: 'spells-modal-ok', class: %w(btn btn-success),
          'data-bs-dismiss': 'modal') %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
