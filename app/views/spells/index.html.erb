<%= safe_join([
  content_tag(:h1, 'Spell List'),
  content_tag(:div, id: 'narrowing') do
    content_tag(:table) do
      content_tag(:thead) do
        content_tag(:tr) do
          safe_join(
            [ '', 'Class', 'School', 'Level', 'Casting Time', 'Ritual?', 'Range', 
              'Components', 'Duration', 'Concentration?' ].map { |lab| content_tag(:th, lab) }
          )
        end
      end <<
      content_tag(:tbody) do
        content_tag(:form, id: 'narrow-select') do
          hidden_field_tag('spell[none]', 0) <<
          content_tag(:tr) do
            safe_join [
              check_box_tag('spell[sort_by_level]', '1', true) << 
              label_tag('spell[sort_by_level]', 'Sort by level') << 
              content_tag(:br) <<
              button_tag('Update', id: 'spell-narrow-fetch', class: 'btn btn-primary', type: 'button'),

              select_tag('spell[caster_class_ids]', options_from_collection_for_select(CasterClass.order(:name), :id, :name), multiple: true),
              select_tag('spell[school_id]', options_for_select(SpellSchool::options_for_select), multiple: true),
              select_tag('spell[level]', options_for_select([[ 'Cantrip', 0 ]] + (1..9).zip( (1..9).to_a) ), multiple: true),
              select_tag('spell[cast_unit]', options_for_select(TimeUnit::options_for_select), multiple: true),
              select_tag('spell[ritual]', options_for_select([[ 'yes', 't' ], [ 'no', 'f' ]]), multiple: true),
              select_tag('spell[range_unit]', options_for_select(DistanceUnit::options_for_select), multiple: true),
              select_tag('spell[components]', options_for_select([
                [ 'Verbal', 8 ], [ 'Somatic', 4 ], [ 'Material', 2 ], [ 'Focus', 1 ]
              ]), multiple: true),
              select_tag('spell[duration_unit]', options_for_select(TimeUnit::options_for_select), multiple: true),
              select_tag('spell[concentration]', options_for_select([[ 'yes', 't' ], [ 'no', 'f' ]]), multiple: true),
            ].map { |x| content_tag(:td, x) }
          end
        end
      end
    end
  end,
  content_tag(:div, nil, id: 'spells-results', class: 'results')
]) %>
