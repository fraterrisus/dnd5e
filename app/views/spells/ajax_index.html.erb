<% last_value = -1 %>
<%= render partial: 'spells/filters', locals: { filters: filters } %>
<%= content_tag(:div, "Matched #{@spells.count} spells", style: 'font-style: italic') %>
<%=
safe_join( @spells.map do |spell|
  items = [ ]
  items << spell.school_text
  items << spell.level_text
  items << spell.casting_time_text
  items << spell.range_text
  items << spell.components_text
  items << spell.duration_text

  comparison_attribute = (bylevel) ? spell.level : spell.name[0]
  if comparison_attribute != last_value
    last_value = comparison_attribute
    div_classes = %w(new-section)
  else
    div_classes = []
  end

  tag.div(class: div_classes) do
    safe_join([
      tag.a(class: %w(bi bi-pencil text-primary), 'data-spell-file': spell.to_asset),
      tag.a(class: %w(fas fa-eye), 'data-spell-file': spell.to_asset),
      tag.a(class: %w(fas fa-edit), 'data-spell-id': spell.id),
      safe_join( [ tag.b { spell.name } ] + items, ' &ndash; '.html_safe )
    ], '&nbsp;'.html_safe)
  end
end )
%>
